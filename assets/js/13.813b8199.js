(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{194:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"pm2介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" pm2介绍")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://pm2.io/doc/en/runtime/overview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pm2"),a("OutboundLink")],1),t._v("是一个流行的进程管理工具，nodejs常用它来做进程管理，支持负载均衡、自动重启、性能监控等")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("可以全局依赖安装，也可以本地依赖安装")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g pm2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全局依赖安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --save-prod pm2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#本地依赖安装")]),t._v("\n")])])]),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("p",[t._v("简单的启动命令如下")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 start app.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全局依赖安装pm2")]),t._v("\n./node_modules/pm2/bin/pm2 start app.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#本地依赖安装pm2")]),t._v("\n")])])]),a("p",[t._v("生成开机自启动的命令如下")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 startup "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#生成开机启动")]),t._v("\n")])])]),a("p",[t._v("一旦pm2启动了，会在"),a("code",[t._v("$HOME/.pm2/")]),t._v("下生成一系列文件或者文件夹，大致如下")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#包含PM2相关的所有文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/logs/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PM2下所有应用的日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/pids/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PM2下所有应用的pids文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/pm2.log "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PM2日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/pm2.pid "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PM2的pid日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/rpc.sock "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#远程命令的socket文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/pub.sock "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Socket file for publishable events")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/conf.js "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PM2 Configuration，在mac下会是module_conf.json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/.pm2/modules/ \n")])])]),a("h2",{attrs:{id:"ecosystem-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ecosystem-file","aria-hidden":"true"}},[t._v("#")]),t._v(" Ecosystem file")]),t._v(" "),a("p",[t._v("可以在pm2命令行中指定各项配置，但是最佳实践是使用"),a("a",{attrs:{href:"https://pm2.io/doc/en/runtime/guide/ecosystem-file/",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置文件"),a("OutboundLink")],1),t._v("ecosystem.config.js文件，"),a("code",[t._v("pm2 start")]),t._v("会默认使用当前文件夹下面的"),a("code",[t._v("ecosystem.config.js")]),t._v("文件，也可以指定配置文件"),a("code",[t._v("pm2 start /path/to/ecosystem.config.js")]),t._v(",可以手动在项目根路径中创建该文件，也可以在项目根路径中使用如下生成命令创建")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 init "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化一个ecosystem.config.js文件")]),t._v("\n")])])]),a("p",[t._v("ecosystem.config.js的常见内容格式如下，更详细信息查看"),a("a",{attrs:{href:"https://pm2.io/doc/en/runtime/reference/ecosystem-file/",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    apps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'APP'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在pm2管理中的应用名称")]),t._v("\n        script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//启动的脚本名称，在cwd有值的情况下是相对于cwd路径的")]),t._v("\n        cwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/project'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//项目的工作路径")]),t._v("\n        args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'one two'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//传递给启动脚本的参数")]),t._v("\n        instances"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//以cluster 模式启动的实例数量，默认为1，max为按照cpu数量最大来创建")]),t._v("\n        exec_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fork'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//启动模式，fork/cluster，默认为fork")]),t._v("\n        autorestart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//进程挂掉后是否自动启动，默认为true")]),t._v("\n        watch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否监控文件变化以重启应用，默认为true")]),t._v("\n        max_memory_restart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1G'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//超过多大的内存后进行重启")]),t._v("\n        output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/outputfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//stdout的日志输出文件路径，默认为~/.pm2/logs/APPNAME-out.log")]),t._v("\n        error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/errorfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//stderr的日志输出文件路径，默认为~/.pm2/logs/APPNAME-error.log")]),t._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/logfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//包含stdout和stderr的日志文件路径，默认为/dev/null")]),t._v("\n        port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//env的PORT环境变量的快捷字段")]),t._v("\n        env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//不使用--env参数时传递给process.env的环境变量")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        env_production"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//pm2 start app.js --env production使用--env参数时传递给process.env的环境变量")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ANOTHER-APP'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'another.js'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"命令列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令列表","aria-hidden":"true"}},[t._v("#")]),t._v(" 命令列表")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://pm2.io/doc/en/runtime/features/commands-cheatsheet/",target:"_blank",rel:"noopener noreferrer"}},[t._v("常用命令"),a("OutboundLink")],1),t._v("列表如下")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pm2 start app.js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-i number/max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动app.js，-i来指定instance数量")]),t._v("\npm2 start app.js --watch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("--ignore-watch /*/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动应用并且当文件变化时自动重启")]),t._v("\npm2 start "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按应用名称/应用ID来启动应用")]),t._v("\npm2 stop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按应用名称/应用ID来停止应用")]),t._v("\npm2 restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按应用名称/应用ID来重启应用")]),t._v("\npm2 delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按应用名称/应用ID来删除应用")]),t._v("\npm2 list "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出所有应用")]),t._v("\npm2 show "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#按应用名称/应用ID来显示应用信息")]),t._v("\npm2 prettylist "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#以可读性好的json形式列出所有应用信息")]),t._v("\npm2 restart app --update-env "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改了ecosystem.config.js的env后需要--update-env来重启更新")]),t._v("\npm2 logs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#显示日志，或者某个应用的日志")]),t._v("\npm2 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("app_id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#显示某个app的环境变量信息")]),t._v("\npm2 monitor "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#显示监控信息")]),t._v("\n")])])])])},[],!1,null,null,null);s.default=e.exports}}]);